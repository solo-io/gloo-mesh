syntax = "proto3";
package config.prometheus.io;
option go_package = "github.com/solo-io/supergloo/pkg/api/external/prometheus/v1";

import "gogoproto/gogo.proto";
option (gogoproto.equal_all) = true;

import "github.com/solo-io/solo-kit/api/v1/metadata.proto";

/*
@solo-kit:resource.short_name=pcf
@solo-kit:resource.plural_name=prometheusconfigs
@solo-kit:resource.resource_groups=observability.config.prometheus.io

Prometheus Config
 */
message Config {
    // jsontag is used to refer to the common kubernetes configmap key
    PrometheusConfig prometheus = 1 [(gogoproto.customprotoname) = "prometheus.yml"];

    // Metadata contains the object metadata for this resource
    core.solo.io.Metadata metadata = 7 [(gogoproto.nullable) = false];
}


message AlertingConfig {
    repeated RelabelConfig alert_relabel_configs = 1;
    repeated AlertmanagerConfig alertmanager_configs = 2;
}

message AlertmanagerConfig {
    string scheme = 1;
    string path_prefix = 2;
    repeated RelabelConfig relabel_configs = 3;
}

message PrometheusConfig {
    GlobalConfig global_config = 1 [(gogoproto.nullable) = false];
    AlertingConfig alerting_config = 2 [(gogoproto.nullable) = false];
    repeated string rule_files = 3;
    repeated ScrapeConfig scrape_configs = 4;
    repeated RemoteWriteConfig remote_write_configs = 5;
    repeated RemoteReadConfig remote_read_configs = 6;
}

message GlobalConfig {
}

// QueueConfig is the configuration for the queue used to write to remote
// storage.
message QueueConfig {
    int64 capacity = 1 [(gogoproto.casttype) = "int"];
    int64 max_shards = 2 [(gogoproto.casttype) = "int"];
    int64 max_samples_per_send = 3 [(gogoproto.casttype) = "int"];
    int64 max_retries = 4 [(gogoproto.casttype) = "int"];
}

// Regexp encapsulates a regexp.Regexp and makes it YAML marshallable.
message Regexp {
}

// RelabelConfig is the configuration for relabeling of target label sets.
message RelabelConfig {
    string separator = 1;
    Regexp regex = 2 [(gogoproto.nullable) = false];
    uint64 modulus = 3;
    string target_label = 4;
    string replacement = 5;
    string action = 6 [(gogoproto.casttype) = "RelabelAction"];
}

// RemoteReadConfig is the configuration for reading from remote storage.
message RemoteReadConfig {
    bool read_recent = 1;
}

// RemoteWriteConfig is the configuration for writing to remote storage.
message RemoteWriteConfig {
    repeated RelabelConfig write_relabel_configs = 1;
    QueueConfig queue_config = 2 [(gogoproto.nullable) = false];
}

message ScrapeConfig {
    string job_name = 1;
    bool honor_labels = 2;
    string metrics_path = 3;
    string scheme = 4;
    uint64 sample_limit = 5 [(gogoproto.casttype) = "uint"];
    repeated RelabelConfig relabel_configs = 6;
    repeated RelabelConfig metric_relabel_configs = 7;
}

