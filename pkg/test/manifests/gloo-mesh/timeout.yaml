apiVersion: networking.mesh.gloo.solo.io/v1
kind: VirtualMesh
metadata:
  name: virtual-mesh
  namespace: gloo-mesh
spec:
  mtlsConfig:
    autoRestartPods: true
    shared:
      rootCertificateAuthority:
        secret:
          name: cacerts
          namespace: istio-system
  federation: {}
  meshes:
  - name: istiod-istio-system-cluster-0
    namespace: gloo-mesh
  - name: istiod-istio-system-cluster-1
    namespace: gloo-mesh
---
apiVersion: networking.mesh.gloo.solo.io/v1
kind: TrafficPolicy
metadata:
  namespace: gloo-mesh
  name: timeout-test
spec:
  destinationSelector:
  - kubeServiceMatcher:
      labels:
        app: frontend
      namespaces:
      - {{.EchoContext.AppNamespace.Name}}
  policy:
    requestTimeout: 1s